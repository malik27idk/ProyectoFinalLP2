<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Catálogo de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSRF META -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <style>
        .card-img-top {
            height: 250px;
            object-fit: cover;
            object-position: center;
        }

        .card {
            transition: transform 0.2s ease-in-out;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-title {
            margin-bottom: 1rem;
            min-height: 3rem;
            display: flex;
            align-items: center;
        }

        .precio {
            font-size: 1.25rem;
            font-weight: bold;
            color: #198754;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="mb-4 text-center">Catálogo de Zapatillas</h2>

    <!-- Filtros -->
    <form id="filtroForm" class="row mb-4" onsubmit="event.preventDefault();">
        <div class="col-md-4">
            <input type="text" name="nombre" class="form-control" placeholder="Buscar por nombre..." oninput="filtrarProductos()">
        </div>
        <div class="col-md-4">
            <select name="categoria" class="form-select" onchange="filtrarProductos()">
                <option value="">Todas las categorías</option>
                <option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.nombre}"></option>
            </select>
        </div>
        <div class="col-md-4">
            <select name="marca" class="form-select" onchange="filtrarProductos()">
                <option value="">Todas las marcas</option>
                <option th:each="m : ${marcas}" th:value="${m.id}" th:text="${m.nombre}"></option>
            </select>
        </div>
    </form>

    <!-- Productos (fragmento dinámico) -->
    <div id="lista-productos" th:replace="productos/fragmento :: listaProductos(${productos})"></div>

    <div class="text-center mt-5">
        <a href="/" class="btn btn-secondary">← Volver al inicio</a>
    </div>
</div>

<script>
function filtrarProductos() {
    const form = document.getElementById("filtroForm");
    const formData = new FormData(form);

    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute("content");
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");

    fetch("/productos/filtrar", {
        method: "POST",
        headers: {
            [csrfHeader]: csrfToken
        },
        body: new URLSearchParams(formData)
    })
    .then(response => response.text())
    .then(html => {
        const contenedor = document.getElementById("lista-productos");
        if (contenedor) {
            contenedor.innerHTML = html;
        } else {
            console.warn("El contenedor #lista-productos no fue encontrado.");
        }
    })
    .catch(error => console.error("Error en la petición fetch:", error));
}
</script>

</body>
</html>
